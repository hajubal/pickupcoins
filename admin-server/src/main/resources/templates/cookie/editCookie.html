<!doctype html>
<html th:replace="~{layout/main :: layout(~{::title}, ~{::div#layout-container-page})}" xmlns:th="http://www.thymeleaf.org">
<head></head>
<body>
  <div id="layout-container-page" class="max-w-2xl mx-auto">
    <!-- Header Section -->
    <div class="mb-8">
      <div class="flex items-center space-x-2 text-sm text-muted-foreground mb-4">
        <a href="/cookies" class="hover:text-foreground transition-colors">Cookies</a>
        <i class="bx bx-chevron-right h-4 w-4"></i>
        <span class="text-foreground">Edit Cookie</span>
      </div>
      <div class="space-y-1">
        <h1 class="text-3xl font-bold tracking-tight">Edit Cookie</h1>
        <p class="text-muted-foreground">Update cookie information and settings</p>
      </div>
    </div>

    <!-- Status Badge -->
    <div class="mb-6">
      <div th:if="${cookie.isValid}" class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold bg-green-50 border-green-200 text-green-700">
        <div class="w-1.5 h-1.5 rounded-full bg-green-500 mr-2"></div>
        Valid Cookie
      </div>
      <div th:unless="${cookie.isValid}" class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold bg-red-50 border-red-200 text-red-700">
        <div class="w-1.5 h-1.5 rounded-full bg-red-500 mr-2"></div>
        Invalid Cookie
      </div>
    </div>

    <!-- Main Form Card -->
    <div class="card">
      <div class="card-header">
        <div class="flex items-center justify-between">
          <div class="space-y-1">
            <div class="card-title">Cookie Information</div>
            <div class="card-description">Update the cookie details</div>
          </div>
          <div class="text-sm text-muted-foreground">
            ID: <span class="font-mono" th:text="${cookie.id}">123</span>
          </div>
        </div>
      </div>
      
      <div class="card-content space-y-6">
        <form th:action="@{/cookie/{id}(id=${cookie.id})}" th:object="${cookie}" method="post" id="edit-form" class="space-y-6">
          
          <!-- Global Errors -->
          <div th:if="${#fields.hasGlobalErrors()}" class="space-y-2">
            <div class="alert alert-danger" th:each="err : ${#fields.globalErrors()}">
              <i class="bx bx-error-circle h-4 w-4 mr-2"></i>
              <span th:text="${err}">Global error message</span>
            </div>
          </div>

          <!-- Hidden ID Field -->
          <input type="hidden" th:field="*{id}">

          <!-- User Name Field -->
          <div class="space-y-2">
            <label for="userName" class="label" th:text="#{cookie.userName}">User Name</label>
            <input 
              type="text" 
              id="userName" 
              th:field="*{userName}"
              th:classappend="${#fields.hasErrors('userName')} ? 'border-destructive' : ''"
              class="input" 
              placeholder="Enter your username"
            />
            <div th:if="${#fields.hasErrors('userName')}" class="form-error">
              <i class="bx bx-error-circle h-4 w-4 mr-1"></i>
              <span th:errors="*{userName}">Username error</span>
            </div>
          </div>

          <!-- Site Name Field -->
          <div class="space-y-2">
            <label for="siteName" class="label" th:text="#{cookie.siteName}">Site Name</label>
            <select 
              th:field="*{siteName}" 
              id="siteName" 
              class="select"
            >
              <option th:each="name : ${siteName}" th:value="${name}" th:selected="${name == cookie.siteName}" th:text="${name}">Site Name</option>
            </select>
          </div>

          <!-- Cookie Value Field -->
          <div class="space-y-2">
            <label for="cookie" class="label" th:text="#{cookie.cooke}">Cookie Value</label>
            <textarea 
              id="cookie" 
              th:field="*{cookie}"
              th:classappend="${#fields.hasErrors('cookie')} ? 'border-destructive' : ''"
              class="textarea min-h-[120px]" 
              placeholder="Paste your cookie value here..."
            ></textarea>
            <div class="form-description">
              Update the cookie value from your browser's developer tools
            </div>
            <div th:if="${#fields.hasErrors('cookie')}" class="form-error">
              <i class="bx bx-error-circle h-4 w-4 mr-1"></i>
              <span th:errors="*{cookie}">Cookie error</span>
            </div>
          </div>

          <!-- Validation Status -->
          <div class="space-y-2">
            <label for="isValid" class="label" th:text="#{cookie.isValid}">Validation Status</label>
            <select 
              th:field="*{isValid}" 
              id="isValid" 
              class="select"
            >
              <option th:value="true" th:selected="${cookie.isValid}">Valid</option>
              <option th:value="false" th:selected="${!cookie.isValid}">Invalid</option>
            </select>
            <div class="form-description">
              Set whether this cookie is currently valid
            </div>
          </div>

        </form>
      </div>
      
      <!-- Form Actions -->
      <div class="card-footer">
        <div class="flex items-center justify-between">
          <button type="button" class="btn btn-outline" th:onclick="|location.href='@{/cookies}'|">
            <i class="bx bx-arrow-back h-4 w-4 mr-2"></i>
            Back to List
          </button>
          <div class="flex items-center space-x-3">
            <button type="submit" form="edit-form" class="btn btn-default">
              <i class="bx bx-save h-4 w-4 mr-2"></i>
              Update Cookie
            </button>
            <button type="button" class="btn btn-destructive" onclick="showDeleteDialog()">
              <i class="bx bx-trash h-4 w-4 mr-2"></i>
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Dialog -->
    <div id="deleteDialog" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
      <div class="card w-full max-w-md mx-4">
        <div class="card-header">
          <div class="flex items-center space-x-2">
            <div class="flex h-8 w-8 items-center justify-center rounded-full bg-red-50">
              <i class="bx bx-trash h-4 w-4 text-red-600"></i>
            </div>
            <div class="card-title text-base">Delete Cookie</div>
          </div>
        </div>
        <div class="card-content">
          <p class="text-sm text-muted-foreground">
            Are you sure you want to delete this cookie? This action cannot be undone.
          </p>
          <div class="mt-4 p-3 bg-muted rounded-lg">
            <p class="text-sm font-mono">ID: <span th:text="${cookie.id}">123</span></p>
            <p class="text-sm font-mono">User: <span th:text="${cookie.userName}">username</span></p>
          </div>
        </div>
        <div class="card-footer">
          <div class="flex items-center justify-end space-x-3">
            <button type="button" class="btn btn-outline" onclick="hideDeleteDialog()">
              Cancel
            </button>
            <button type="button" class="btn btn-destructive" onclick="confirmDelete()">
              <i class="bx bx-trash h-4 w-4 mr-2"></i>
              Delete Cookie
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Hidden delete form -->
    <form id="deleteForm" th:action="@{/cookie/{id}(id=${cookie.id})}" th:method="delete" class="hidden">
    </form>
  </div>

  <script>
    function showDeleteDialog() {
      document.getElementById('deleteDialog').classList.remove('hidden');
    }

    function hideDeleteDialog() {
      document.getElementById('deleteDialog').classList.add('hidden');
    }

    function confirmDelete() {
      const deleteBtn = event.target;
      const originalText = deleteBtn.innerHTML;
      
      deleteBtn.disabled = true;
      deleteBtn.innerHTML = '<i class="bx bx-loader-alt bx-spin h-4 w-4 mr-2"></i>Deleting...';
      
      setTimeout(() => {
        document.getElementById('deleteForm').submit();
      }, 500);
    }

    // Form validation feedback
    document.getElementById('edit-form').addEventListener('submit', function(e) {
      const submitBtn = document.querySelector('button[form="edit-form"]');
      const originalText = submitBtn.innerHTML;
      
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<i class="bx bx-loader-alt bx-spin h-4 w-4 mr-2"></i>Updating...';
      
      // Re-enable button after 3 seconds if form doesn't submit
      setTimeout(() => {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
      }, 3000);
    });

    // Close dialog when clicking outside
    document.getElementById('deleteDialog').addEventListener('click', function(e) {
      if (e.target === this) {
        hideDeleteDialog();
      }
    });
  </script>

</body>
</html>
