<!doctype html>
<html th:replace="~{layout/main :: layout(~{::title}, ~{::div#layout-container-page})}" xmlns:th="http://www.thymeleaf.org">
<head></head>
<body>
  <div id="layout-container-page" class="max-w-7xl mx-auto">
    <!-- Header Section -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900">Point URLs</h1>
      <p class="text-gray-600 mt-2">Manage point collection URLs and crawling operations</p>
    </div>

    <!-- Main Content Card -->
    <div class="card">
      <div class="p-6">
        <!-- Header with Action Buttons -->
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
          <div>
            <h2 class="text-xl font-semibold text-gray-800">URL Management</h2>
            <p class="text-sm text-gray-600 mt-1">Monitor and manage point collection URLs</p>
          </div>
          <div class="flex flex-wrap gap-2">
            <button type="button" class="btn btn-outline" th:onclick="|location.href='@{/savePoint}'|">
              <i class="bx bx-collection mr-2 h-4 w-4"></i>
              포인트 수집
            </button>
            <button type="button" class="btn btn-outline" th:onclick="|location.href='@{/crawling}'|">
              <i class="bx bx-search mr-2 h-4 w-4"></i>
              크롤링
            </button>
            <button type="button" class="btn btn-default" th:onclick="report()">
              <i class="bx bx-bar-chart-alt-2 mr-2 h-4 w-4"></i>
              Report
            </button>
          </div>
        </div>

        <!-- Table -->
        <div class="overflow-x-auto">
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Site Name</th>
                <th>Type</th>
                <th>URL</th>
                <th>Created Date</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="item : ${items}" th:id="'url-row-' + ${item.id}">
                <td>
                  <span class="text-primary-600 font-medium" th:text="${item.id}">id</span>
                </td>
                <td>
                  <div class="flex items-center">
                    <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-blue-600 rounded-lg flex items-center justify-center mr-3">
                      <span class="text-white font-bold text-xs" th:text="${#strings.substring(item.name, 0, 1)}">S</span>
                    </div>
                    <span class="font-medium text-gray-900" th:text="${item.name}">site name</span>
                  </div>
                </td>
                <td>
                  <span th:if="${item.permanent}" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                    <i class="bx bx-pin mr-1"></i>
                    Permanent
                  </span>
                  <span th:unless="${item.permanent}" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                    <i class="bx bx-time mr-1"></i>
                    Temporary
                  </span>
                </td>
                <td>
                  <div class="max-w-xs">
                    <p class="text-sm text-blue-600 hover:text-blue-800 break-all" th:text="${item.url}">url</p>
                  </div>
                </td>
                <td>
                  <div class="text-sm text-gray-900" th:text="${#temporals.format(item.createdDate, 'yyyy-MM-dd HH:mm')}">create date</div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="mt-6 flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6" th:if="${items.totalPages > 1}">
          <div class="flex flex-1 justify-between sm:hidden">
            <a th:href="${items.first} ? '#' : @{/pointUrl(page=${items.number - 1})}" 
               th:class="${items.first} ? 'relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-400 cursor-not-allowed' : 'relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50'">
              Previous
            </a>
            <a th:href="${items.last} ? '#' : @{/pointUrl(page=${items.number + 1})}"
               th:class="${items.last} ? 'relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-400 cursor-not-allowed' : 'relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50'">
              Next
            </a>
          </div>
          <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
            <div>
              <p class="text-sm text-gray-700">
                Showing 
                <span class="font-medium" th:text="${items.number * items.size + 1}">1</span>
                to 
                <span class="font-medium" th:text="${items.last ? items.totalElements : (items.number + 1) * items.size}">10</span>
                of 
                <span class="font-medium" th:text="${items.totalElements}">97</span>
                results
              </p>
            </div>
            <div>
              <nav class="isolate inline-flex -space-x-px rounded-md shadow-sm" aria-label="Pagination">
                <a th:href="${items.first} ? '#' : @{/pointUrl(page=${items.number - 1})}" 
                   th:class="${items.first} ? 'relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 cursor-not-allowed' : 'relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0'">
                  <i class="bx bx-chevron-left h-5 w-5"></i>
                </a>
                
                <th:block th:each="page: ${#numbers.sequence(startPage, endPage)}">
                  <a th:if="${page - 1 == items.number}"
                     th:text="${page}"
                     class="relative z-10 inline-flex items-center bg-primary-600 px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600">
                  </a>
                  <a th:unless="${page - 1 == items.number}"
                     th:href="@{/pointUrl(page=${page - 1})}"
                     th:text="${page}"
                     class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                  </a>
                </th:block>
                
                <a th:href="${items.last} ? '#' : @{/pointUrl(page=${items.number + 1})}"
                   th:class="${items.last} ? 'relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 cursor-not-allowed' : 'relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0'">
                  <i class="bx bx-chevron-right h-5 w-5"></i>
                </a>
              </nav>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div th:if="${#lists.isEmpty(items.content)}" class="text-center py-12">
          <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="bx bx-link text-gray-400 text-2xl"></i>
          </div>
          <h3 class="text-lg font-medium text-gray-900 mb-2">No URLs found</h3>
          <p class="text-gray-500 mb-4">There are no point URLs configured yet.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    function report() {
      // Show loading state
      const reportBtn = event.target;
      const originalText = reportBtn.innerHTML;
      reportBtn.innerHTML = '<i class="bx bx-loader-alt bx-spin mr-2"></i>Loading...';
      reportBtn.disabled = true;

      $.ajax({
        url: '[[@{/report}]]',
        method: 'get',
        async: true,
        success: function () {
          // Show success notification
          showNotification('Report generated successfully!', 'success');
        },
        error: function() {
          showNotification('Failed to generate report. Please try again.', 'error');
        },
        complete: function() {
          // Restore button state
          reportBtn.innerHTML = originalText;
          reportBtn.disabled = false;
        }
      });
    }

    function showNotification(message, type) {
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 z-50 px-4 py-3 rounded-md shadow-lg transition-opacity duration-300 ${type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }
  </script>

</body>
</html>
