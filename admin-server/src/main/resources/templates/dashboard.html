<!doctype html>
<html th:replace="~{layout/main :: layout(~{::title}, ~{::div#layout-container-page})}" xmlns:th="http://www.thymeleaf.org">
  <head></head>
  <body>
    <div id="layout-container-page" class="max-w-7xl mx-auto">
      <!-- Header Section -->
      <div class="mb-8 space-y-4">
        <div class="flex items-center justify-between">
          <div class="space-y-1">
            <h1 class="text-3xl font-bold tracking-tight">Dashboard</h1>
            <p class="text-muted-foreground">Welcome back! Here's what's happening with your points.</p>
          </div>
          <div class="flex items-center space-x-2">
            <button class="btn btn-outline btn-sm">
              <i class="bx bx-refresh h-4 w-4 mr-2"></i>
              Refresh
            </button>
            <div class="badge badge-default">
              <i class="bx bx-time h-3 w-3 mr-1"></i>
              Live Data
            </div>
          </div>
        </div>
      </div>

      <!-- Stats Grid -->
      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-4 mb-8">
        <!-- Day Point Card -->
        <div class="card">
          <div class="card-content p-6">
            <div class="flex items-center justify-between">
              <div class="space-y-2">
                <p class="text-sm font-medium text-muted-foreground">Today's Points</p>
                <div class="flex items-baseline space-x-2">
                  <p class="text-2xl font-bold" th:text="${dashboardDto.getSavedDayPoint()}">0</p>
                  <div class="flex items-center text-xs" 
                       th:classappend="${dashboardDto.getSavedDayPointRatioDayBefore() >= 0} ? 'text-emerald-600' : 'text-destructive'">
                    <i class="bx h-3 w-3 mr-1" 
                       th:classappend="${dashboardDto.getSavedDayPointRatioDayBefore() >= 0} ? 'bx-trending-up' : 'bx-trending-down'"></i>
                    <span th:text="${dashboardDto.getSavedDayPointRatioDayBefore()} + '%'">0%</span>
                  </div>
                </div>
                <p class="text-xs text-muted-foreground">from yesterday</p>
              </div>
              <div class="flex h-12 w-12 items-center justify-center rounded-full bg-blue-50 text-blue-600">
                <i class="bx bx-trending-up h-6 w-6"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Week Point Card -->
        <div class="card">
          <div class="card-content p-6">
            <div class="flex items-center justify-between">
              <div class="space-y-2">
                <p class="text-sm font-medium text-muted-foreground">Weekly Points</p>
                <div class="flex items-baseline space-x-2">
                  <p class="text-2xl font-bold" th:text="${dashboardDto.getSavedWeekPoint()}">0</p>
                  <div class="flex items-center text-xs" 
                       th:classappend="${dashboardDto.getSavedWeekPointRatioWeekBefore() >= 0} ? 'text-emerald-600' : 'text-destructive'">
                    <i class="bx h-3 w-3 mr-1" 
                       th:classappend="${dashboardDto.getSavedWeekPointRatioWeekBefore() >= 0} ? 'bx-trending-up' : 'bx-trending-down'"></i>
                    <span th:text="${dashboardDto.getSavedWeekPointRatioWeekBefore()} + '%'">0%</span>
                  </div>
                </div>
                <p class="text-xs text-muted-foreground">from last week</p>
              </div>
              <div class="flex h-12 w-12 items-center justify-center rounded-full bg-green-50 text-green-600">
                <i class="bx bx-calendar h-6 w-6"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Day Point URL Card -->
        <div class="card">
          <div class="card-content p-6">
            <div class="flex items-center justify-between">
              <div class="space-y-2">
                <p class="text-sm font-medium text-muted-foreground">Daily URLs</p>
                <div class="flex items-baseline space-x-2">
                  <p class="text-2xl font-bold" th:text="${dashboardDto.getPointUrlDayCnt()}">0</p>
                  <span class="text-xs text-muted-foreground">collected</span>
                </div>
                <p class="text-xs text-muted-foreground">URLs found today</p>
              </div>
              <div class="flex h-12 w-12 items-center justify-center rounded-full bg-purple-50 text-purple-600">
                <i class="bx bx-link h-6 w-6"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Week Point URL Card -->
        <div class="card">
          <div class="card-content p-6">
            <div class="flex items-center justify-between">
              <div class="space-y-2">
                <p class="text-sm font-medium text-muted-foreground">Weekly URLs</p>
                <div class="flex items-baseline space-x-2">
                  <p class="text-2xl font-bold" th:text="${dashboardDto.getPointUrlWeekCnt()}">0</p>
                  <span class="text-xs text-muted-foreground">collected</span>
                </div>
                <p class="text-xs text-muted-foreground">URLs found this week</p>
              </div>
              <div class="flex h-12 w-12 items-center justify-center rounded-full bg-orange-50 text-orange-600">
                <i class="bx bx-collection h-6 w-6"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="grid gap-6 md:grid-cols-2 mb-8">
        <!-- Point Report Chart -->
        <div class="card">
          <div class="card-header">
            <div class="flex items-center justify-between">
              <div class="space-y-1">
                <div class="card-title">Point Report</div>
                <div class="card-description">Weekly point collection overview</div>
              </div>
              <div class="flex items-center space-x-2">
                <div class="badge badge-secondary">
                  <i class="bx bx-calendar h-3 w-3 mr-1"></i>
                  Weekly
                </div>
              </div>
            </div>
          </div>
          <div class="card-content">
            <div class="text-3xl font-bold mb-2" th:text="${dashboardDto.getSavedWeekPoint()}">0</div>
            <div id="pointReportChart" class="h-24"></div>
          </div>
        </div>

        <!-- Additional Stats Card -->
        <div class="card">
          <div class="card-header">
            <div class="space-y-1">
              <div class="card-title">Performance Overview</div>
              <div class="card-description">Key metrics and performance indicators</div>
            </div>
          </div>
          <div class="card-content space-y-4">
            <div class="flex items-center justify-between p-4 border rounded-lg bg-muted/50">
              <div class="flex items-center space-x-3">
                <div class="flex h-10 w-10 items-center justify-center rounded-full bg-blue-50">
                  <i class="bx bx-chart h-5 w-5 text-blue-600"></i>
                </div>
                <div>
                  <p class="text-sm font-medium">Average Daily</p>
                  <p class="text-xs text-muted-foreground">Points per day</p>
                </div>
              </div>
              <div class="text-right">
                <p class="text-lg font-bold" th:text="${dashboardDto.getSavedWeekPoint() / 7}">0</p>
                <p class="text-xs text-muted-foreground">avg/day</p>
              </div>
            </div>

            <div class="flex items-center justify-between p-4 border rounded-lg bg-muted/50">
              <div class="flex items-center space-x-3">
                <div class="flex h-10 w-10 items-center justify-center rounded-full bg-green-50">
                  <i class="bx bx-target-lock h-5 w-5 text-green-600"></i>
                </div>
                <div>
                  <p class="text-sm font-medium">Collection Rate</p>
                  <p class="text-xs text-muted-foreground">URLs to points ratio</p>
                </div>
              </div>
              <div class="text-right">
                <p class="text-lg font-bold" th:text="${dashboardDto.getPointUrlWeekCnt() > 0 ? (dashboardDto.getSavedWeekPoint() / dashboardDto.getPointUrlWeekCnt()) : 0}">0</p>
                <p class="text-xs text-muted-foreground">pts/url</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="card">
        <div class="card-header">
          <div class="flex items-center justify-between">
            <div class="space-y-1">
              <div class="card-title">Quick Actions</div>
              <div class="card-description">Common tasks and shortcuts</div>
            </div>
          </div>
        </div>
        <div class="card-content">
          <div class="grid gap-4 md:grid-cols-3">
            <button class="btn btn-outline p-6 h-auto flex flex-col items-center space-y-2" 
                    onclick="window.location.href='/savePointLog'">
              <div class="flex h-12 w-12 items-center justify-center rounded-full bg-blue-50">
                <i class="bx bx-history h-6 w-6 text-blue-600"></i>
              </div>
              <div class="text-center">
                <div class="font-medium">View Point Log</div>
                <div class="text-xs text-muted-foreground">Check transaction history</div>
              </div>
            </button>

            <button class="btn btn-outline p-6 h-auto flex flex-col items-center space-y-2" 
                    onclick="window.location.href='/pointUrl'">
              <div class="flex h-12 w-12 items-center justify-center rounded-full bg-green-50">
                <i class="bx bx-link h-6 w-6 text-green-600"></i>
              </div>
              <div class="text-center">
                <div class="font-medium">Manage URLs</div>
                <div class="text-xs text-muted-foreground">Configure point URLs</div>
              </div>
            </button>

            <button class="btn btn-outline p-6 h-auto flex flex-col items-center space-y-2" 
                    onclick="window.location.href='/cookies'">
              <div class="flex h-12 w-12 items-center justify-center rounded-full bg-purple-50">
                <i class="bx bx-cookie h-6 w-6 text-purple-600"></i>
              </div>
              <div class="text-center">
                <div class="font-medium">Manage Cookies</div>
                <div class="text-xs text-muted-foreground">Update authentication</div>
              </div>
            </button>
          </div>
        </div>
      </div>
    </div>

            <script>
              function toggleDropdown(id) {
                const dropdown = document.getElementById(id);
                dropdown.classList.toggle('hidden');
              }

              // Close dropdowns when clicking outside
              document.addEventListener('click', function(event) {
                const dropdowns = document.querySelectorAll('[id^="dropdown"]');
                dropdowns.forEach(dropdown => {
                  if (!dropdown.contains(event.target) && !event.target.closest('button[onclick*="' + dropdown.id + '"]')) {
                    dropdown.classList.add('hidden');
                  }
                });
              });

              // Point Report Line Chart
              const pointReportChartEl = document.querySelector('#pointReportChart');
              if (pointReportChartEl) {
                const pointReportChartConfig = {
                  chart: {
                    height: 80,
                    type: 'line',
                    toolbar: {
                      show: false
                    },
                    sparkline: {
                      enabled: true
                    }
                  },
                  grid: {
                    show: false,
                    padding: {
                      right: 8
                    }
                  },
                  colors: ['#f59e0b'],
                  dataLabels: {
                    enabled: false
                  },
                  stroke: {
                    width: 3,
                    curve: 'smooth'
                  },
                  series: [
                    {
                      data: [[${dashboardDto.getPoints()}]]
                    }
                  ],
                  xaxis: {
                    show: false,
                    lines: {
                      show: false
                    },
                    labels: {
                      show: false
                    },
                    axisBorder: {
                      show: false
                    }
                  },
                  yaxis: {
                    show: false
                  }
                };

                const pointReportChart = new ApexCharts(pointReportChartEl, pointReportChartConfig);
                pointReportChart.render();
              }
            </script>
        </div>
        <!-- / Content -->
    <!-- / Layout page -->
  </body>
</html>
