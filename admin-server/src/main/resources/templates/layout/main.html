<!doctype html>
<html th:fragment="layout (title, content)" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>Pickup Coin</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" th:href="@{/assets/img/favicon/favicon.ico}" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
            rel="stylesheet"/>

    <!-- Icons. Uncomment required icon fonts -->
    <link rel="stylesheet" th:href="@{/assets/vendor/fonts/boxicons.css}" />

    <!-- Tailwind CSS -->
    <link rel="stylesheet" th:href="@{/css/output.css}" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css}" />

    <link rel="stylesheet" th:href="@{/assets/vendor/libs/apex-charts/apex-charts.css}" />

    <!-- Page CSS -->

    <!-- Helpers -->
    <script th:src="@{/assets/vendor/js/helpers.js}"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script th:src="@{/assets/js/config.js}"></script>


    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->
    <script th:src="@{/assets/vendor/libs/jquery/jquery.js}"></script>
    <script th:src="@{/assets/vendor/libs/popper/popper.js}"></script>
    <script th:src="@{/assets/vendor/js/bootstrap.js}"></script>
    <script th:src="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js}"></script>

    <script th:src="@{/assets/vendor/js/menu.js}"></script>
    <!-- endbuild -->

    <!-- Vendors JS -->
    <script th:src="@{/assets/vendor/libs/apex-charts/apexcharts.js}"></script>

    <!-- Main JS -->
    <script th:src="@{/assets/js/main.js}"></script>

    <!-- Page JS -->
    <script th:src="@{/assets/js/dashboards-analytics.js}"></script>

  </head>
  <body class="bg-background text-foreground">
    <div class="flex min-h-screen">
        <!-- Menu -->
        <aside class="w-64 bg-card border-r flex flex-col">
          <div class="p-6 border-b border-border">
            <a th:href="@{/}" class="flex items-center space-x-3">
              <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-primary text-primary-foreground">
                <i class="bx bx-coin text-sm"></i>
              </div>
              <span class="text-xl font-semibold">Pickup Coins</span>
            </a>
          </div>

          <nav class="flex-1 px-3 py-4 space-y-1">
            <!-- Dashboard -->
            <a th:href="@{/dashboard}" class="flex items-center gap-3 rounded-lg px-3 py-2 text-muted-foreground transition-all hover:text-primary">
              <i class="bx bx-home-circle h-4 w-4"></i>
              Dashboard
            </a>

            <a th:href="@{/siteUser}" class="flex items-center gap-3 rounded-lg px-3 py-2 text-muted-foreground transition-all hover:text-primary">
              <i class="bx bx-user h-4 w-4"></i>
              Site User
            </a>

            <a th:href="@{/cookies}" class="flex items-center gap-3 rounded-lg px-3 py-2 text-muted-foreground transition-all hover:text-primary">
              <i class="bx bx-cookie h-4 w-4"></i>
              Cookies
            </a>

            <a th:href="@{/sites}" class="flex items-center gap-3 rounded-lg px-3 py-2 text-muted-foreground transition-all hover:text-primary">
              <i class="bx bx-world h-4 w-4"></i>
              Sites
            </a>

            <a th:href="@{/pointUrl}" class="flex items-center gap-3 rounded-lg px-3 py-2 text-muted-foreground transition-all hover:text-primary">
              <i class="bx bx-link h-4 w-4"></i>
              Point URLs
            </a>

            <a th:href="@{/savePointLog}" class="flex items-center gap-3 rounded-lg px-3 py-2 text-muted-foreground transition-all hover:text-primary">
              <i class="bx bx-history h-4 w-4"></i>
              Logs
            </a>
          </nav>
        </aside>
        <!-- / Menu -->

        <!-- Main Content -->
        <div class="flex-1 flex flex-col">
          <!-- Navbar -->
          <header class="bg-background border-b border-border">
            <div class="flex items-center justify-between px-6 py-3">
              <div class="flex items-center">
                <button class="md:hidden btn btn-ghost btn-icon">
                  <i class="bx bx-menu h-4 w-4"></i>
                </button>
              </div>

              <div class="flex items-center space-x-4">
                <!-- User Dropdown -->
                <div class="relative">
                  <button class="flex items-center space-x-3 rounded-lg px-3 py-2 hover:bg-accent transition-colors" onclick="toggleDropdown()">
                    <div class="flex h-8 w-8 items-center justify-center rounded-full bg-muted">
                      <i class="bx bx-user h-4 w-4"></i>
                    </div>
                    <div class="hidden md:block text-left">
                      <div class="text-sm font-medium" sec:authentication="name">name</div>
                      <div class="text-xs text-muted-foreground" sec:authorize="hasRole('admin')">Admin</div>
                    </div>
                    <i class="bx bx-chevron-down h-4 w-4 text-muted-foreground"></i>
                  </button>
                  
                  <div id="userDropdown" class="hidden absolute right-0 mt-2 w-48 bg-popover rounded-md border shadow-md py-1 z-50">
                    <a th:href="@{/siteUser}" class="flex items-center px-3 py-2 text-sm hover:bg-accent rounded-sm mx-1">
                      <i class="bx bx-user mr-2 h-4 w-4"></i>
                      My Profile
                    </a>
                    <a th:href="@{/sites}" class="flex items-center px-3 py-2 text-sm hover:bg-accent rounded-sm mx-1">
                      <i class="bx bx-cog mr-2 h-4 w-4"></i>
                      Settings
                    </a>
                    <div class="border-t border-border my-1"></div>
                    <a id="logout" th:href="@{/logout}" class="flex items-center px-3 py-2 text-sm hover:bg-accent rounded-sm mx-1 text-destructive">
                      <i class="bx bx-power-off mr-2 h-4 w-4"></i>
                      Log Out
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </header>

          <!-- / Navbar -->

          <!-- Content wrapper -->
          <main class="flex-1 p-6 overflow-y-auto bg-muted/30">

            <th:block th:replace="${content}">
            </th:block>
            
          </main>
          
          <!-- Footer -->
          <footer class="bg-card border-t border-border px-6 py-3">
            <div class="flex justify-between items-center text-sm text-muted-foreground">
              <div></div>
              <div>
                <a href="https://github.com/hajubal/pickupcoins" target="_blank" class="hover:text-primary transition-colors" th:text="|${activeProfile} ${version}|">version</a>
              </div>
            </div>
          </footer>
        </div>
    </div>

    <script>
      function toggleDropdown() {
        document.getElementById('userDropdown').classList.toggle('hidden');
      }
      
      // Close dropdown when clicking outside
      document.addEventListener('click', function(event) {
        const dropdown = document.getElementById('userDropdown');
        const button = event.target.closest('[onclick="toggleDropdown()"]');
        
        if (!button && !dropdown.contains(event.target)) {
          dropdown.classList.add('hidden');
        }
      });
    </script>
  </body>
</html>
